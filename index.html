<!DOCTYPE html>
<html>
<head>
	<title>Ballot Initiatives</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

	<!-- ******** CSS *******-->
	<style type="text/css">
		.state {
			opacity:0.6;    		
			stroke: #fff;
			fill: #dbdbdb;
    		stroke-width: 1;
		}

		.marijuana {
			fill: #98bb49;
		}

		.wage {
			fill: #96CAB4;
		}

		.gun {
			fill: #9194a2;
		}

		.tobacco {
			fill: #75250a;
		}

		.education {
			fill: #ffc125;
		}

		.elections {
			fill: #5ea1d4;
		}

		#tooltip-container {
			height: 75px;
		}

	</style>

</head>
<body>

<div id="filter-container">
 	<form>
		<input type="radio" id="marijuana" name="topic" checked=true/><label for="marijuana">Marijuana</label>
	    <input type="radio" id="wage" name="topic"/><label for="wage">Minimum Wage</label>
	    <input type="radio" id="gun" name="topic"/><label for="gun">Gun control</label>
	    <input type="radio" id="tobacco" name="topic"/><label for="tobacco">Tobacco</label>
	    <input type="radio" id="education" name="topic"/><label for="education">Education</label>
	    <input type="radio" id="elections" name="topic"/><label for="elections">Elections</label>
   </form>
</div>
<div id="tooltip-container"></div>
<div class="map-container"> 
	<div id="map"></div>
</div>

<script>
	//Width and height of map
	var width = 960;
	var height = 500;

	// D3 Projection
	var projection = d3.geoAlbersUsa()
	   .translate([width/2, height/2])
	   .scale([1000]);
        
	var path = d3.geoPath().projection(projection);

	var color = d3.scaleLinear()
		.domain([1,2,3,4,5,6])
    	.range(["#98bb49", "#96CAB4", "#9194a2", "#75250a","#ffc125", "#5ea1d4"]);

	var svg = d3.select("#map").append("svg")
	    .attr("width", width)
	    .attr("height", height);

	var tooltip = d3.select("#tooltip-container")
	    .append("div")   
		.attr("class", "tooltip");               


	var states = [];
	var jsonState;
	var topicObj = {
		"marijuana": 1,
		"wage": 2,
		"gun": 3,
		"tobacco": 4,
		"education": 5,
		"elections": 6
	};

	var checked = "marijuana";

	var clearStates = function(){
		d3.selectAll('.state')
			.style("fill", "#dbdbdb");
	}

	var colorStates = function(checked, state, value){
        d3.selectAll('.' +state)
            .transition()
            .style("fill", function(d){
             	if (d.properties.name == state) {
                	return color(value);
                }
            });  
    }

    

    d3.json("us-states.json", function(us) {
    	svg.selectAll("path")
		.data(us.features)
		.enter()
		.append("path")
		.attr("d", path)
		.attr("class",function(d){
			return "state " + d.properties.name; 
		})

		d3.json("data.json", function(data) { // initiative data
			var dataState;
		    var value;

	    	d3.selectAll("input").on("change", function() {
		        checked = this.id;

		    	for (a = 0; a < data[checked].length; a++) {
		    		dataState = data[checked][a].state;
		    		value = topicObj[checked];
		    		console.log(dataState + ', ' + value);
		    		clearStates();
					colorStates(checked, dataState, value);
		    	}

		    });
	        
		});
    });

	// d3.json("us-states.json", function(json) { // state geoJSON data
		// for (var j = 0; j < json.features.length; j++) {
					// 	if (json.features[j].properties.name == dataState){
					// 		json.features[j].properties.value = topicArray[checked];
					// 	}
					// }
	
       

        d3.selectAll(".highlighted")
			.on("mouseover", function(d) {  
				d3.select(this.parentNode.appendChild(this))
    				.style('stroke','#000')
    				.style('stroke-width', 1.5)
    				.style('opacity','1');
    		
		    	tooltip.transition()        
		      	   .duration(200)            
		           .text(d.properties.name)
			})
			.on("mouseout", function(d) {
				d3.select(this)
    				.style('stroke','#fff')
    				.style('stroke-width', 1)
    				.style('opacity','0.6'); 

		        tooltip.transition()        
		           .duration(200)      
		           .text('')
		    }); 
	// });
	

</script>

</body>
</html>