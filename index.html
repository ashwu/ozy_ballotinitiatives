<!DOCTYPE html>
<html>
<head>
	<title>Ballot Initiatives</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>

	<!-- ******** CSS *******-->
	<style type="text/css">
		.state {
			opacity:0.6;    		
			stroke: #fff;
    		stroke-width: 1;
		}

		#tooltip-container {
			height: 75px;
		}

	</style>

</head>
<body>

<div id="tooltip-container"></div>
<div class="map-container"> 
	<div id="map"></div>
</div>

<script>
	//Width and height of map
	var width = 960;
	var height = 500;

	// D3 Projection
	var projection = d3.geoAlbersUsa()
	   .translate([width/2, height/2])
	   .scale([1000]);
        
	var path = d3.geoPath().projection(projection);

	var color = d3.scaleLinear()
    	.range(["#98bb49", "#96CAB4", "#F0D1DB", "#9194a2", "#75250a","#ffc125", "#5ea1d4"]);

	var svg = d3.select("#map").append("svg")
	    .attr("width", width)
	    .attr("height", height);

	var tooltip = d3.select("#tooltip-container")
	    .append("div")   
		.attr("class", "tooltip");               
		// .style("opacity", 0);

	var states = [];
	var dataState;
	var jsonState;
	var value;

	d3.json("data.json", function(data) { // initiative data
		color.domain([1,2,3,4,5,6,7]);
        for (key in data) {
		    if ( data.hasOwnProperty(key) ) {
		        var values = data[key];
		        for (i = 0; i < values.length; i++) {
		        	if (key == 'marijuana') {
		        		states.push(values[i].state);
		        		value = 1;
		        	} 
		        }
		    }    
		}

		
		d3.json("us-states.json", function(json) { // state geoJSON data
			for (state in states) {
				dataState = states[state];
				for (var j = 0; j < json.features.length; j++) {
		        	jsonState = json.features[j].properties.name;
	        		if (jsonState == dataState) {
	        			console.log(jsonState);
		                json.features[j].properties.value = value;
		                break;
		            }
		        	
		        }
			}
			
	    	svg.selectAll("path")
				.data(json.features)
				.enter()
				.append("path")
				.attr("d", path)
				.attr("class",function(d){
					if (d.properties.value) {
						return "state highlighted";
					} else {
						return "state";
					}
				})
				.style("fill", function(d) {
	                var colorDomain = d.properties.value;
	                if (colorDomain) {
	                    return color(colorDomain);
	                } else {
	                    return "#dbdbdb";
	                }
	            });

	        d3.selectAll(".highlighted")
				.on("mouseover", function(d) {  
					d3.select(this.parentNode.appendChild(this))
        				.style('stroke','#000')
        				.style('stroke-width', 1.5)
        				.style('opacity','1');
        				

			    	tooltip.transition()        
			      	   .duration(200)            
			           .text(d.properties.name)
				})
				.on("mouseout", function(d) {
					d3.select(this.parentNode.appendChild(this))
        				.style('stroke','#fff')
        				.style('stroke-width', 1)
        				.style('opacity','0.6'); 

			        tooltip.transition()        
			           .duration(200)      
			           .text('')
			    }); 
		});
	});
	

</script>

</body>
</html>